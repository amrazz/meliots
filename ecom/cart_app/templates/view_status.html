<!-- Created with [AIPRM Prompt "Python Pro"](https://www.aiprm.com/prompts/softwareengineering/backend-development/2000110/) -->

{% extends 'base.html' %}

{% load static %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    a{
        text-decoration: none;
    }
    video{
        position: absolute;
        margin-left: 206px;
    }

</style>

<link rel="stylesheet" href="{% static 'css/track.css' %}">
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Bootstrap Bundle JS (includes Popper.js) -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

<!-- Font Awesome CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<div class="container-fluid my-5 d-sm-flex justify-content-center">
    <div class="card px-2">

        <div class="card-header bg-white">
            <div class="row justify-content-between">
                <div class="col">


                    <p class="text-muted"> Order ID : <span class="font-weight-bold text-dark">{{order_items.order.tracking_id}}</span></p>
                    <p class="text-muted">Place On <span class="font-weight-bold text-dark">{{ order_items.created_at|date:"F d, Y" }}</span>
                    </p>
                </div>


                <div class="flex-col my-auto">
                    <h6 class="ml-auto mr-3">
                    </h6>
                </div>
            </div>

        </div>
        <div class="card-body">
            <div class="media flex-column flex-sm-row">
                <div class="media-body">
                    <h6 class="bold">{{ order_items.product.product.name }}</h6>
                    <p class="text-muted"> <b>Qt</b>: {{order_items.qty}} </p>
                    <h4 class="mt-3 mb-4 bold"> <span class="mt-5">&#x20B9;</span>
                        {{order_items.product.product.offer_price}} <span class="small text-muted"> via
                            ({{order_items.order.payment_method}}) </span></h4>
                    {% if order_items.order.payment_method == 'Razorpay' %}
                    <div class="d-flex">
                        <p><b>Transaction ID :</b> </p>
                    <p>{{ order_items.order.payment_transaction_id }}</p>
                    </div>
                    {% endif %}
                    <p class="text-muted">Tracking Status on: <span id="current-time"></span>, Today</p>
                </div>
                <img class="align-self-center img-fluid" style="border-radius: 29px;" src="{{order_items.product.image1.url}}" width="180 "
                    height="180">
            </div>
            <div class="active">
                {% if order_items.status == 'Order Placed' %}
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;">
                    </div>
                    <h5>Order Placed</h5><video width="100" height="100" autoplay loop muted>
                        <source src="{% static 'img/van2.mp4' %}" type="video/mp4">
                    </video>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;">
                    </div>
                    <h5>Shipped</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;">
                    </div>
                    <h5>Out of Delivery</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;">
                    </div>
                    <h5>Delivered</h5>
                </div>
                {% elif order_items.status == 'Shipped' %}
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;">
                    </div>
                    <h5>Order Placed</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #009608;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;">
                    </div>
                    <h5>Shipped</h5><video width="100" height="100" autoplay loop muted>
                        <source src="{% static 'img/van2.mp4' %}" type="video/mp4">
                    </video>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;">
                    </div>
                    <h5>Out of Delivery</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;">
                    </div>
                    <h5>Delivered</h5>
                </div>
                {% elif order_items.status == 'Out for Delivery' %}
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;">
                    </div>
                    <h5>Order Placed</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #009608;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;">
                    </div>
                    <h5>Shipped</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #009608;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;">
                    </div>
                    <h5>Out of Delivery</h5><video width="100" height="100" autoplay loop muted>
                        <source src="{% static 'img/van2.mp4' %}" type="video/mp4">
                    </video>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;">
                    </div>
                    <h5>Delivered</h5>
                </div>
                {% elif order_items.status == 'Delivered' %}
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;"></div>
                    <h5>Order Placed</h5>
                </div>

                <div class="track_line" style="width: 2px;height: 100px;background-color: #009608;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;"></div>
                    <h5>Shipped</h5>
                </div>

                <div class="track_line" style="width: 2px;height: 100px;background-color: #009608;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;"></div>
                    <h5>Out of Delivery</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #009608;margin-left: 9px;">
                </div>

            
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #009608;border-radius: 50%;">
                    </div>
                    <h5>Delivered</h5><video  width="100" height="100" autoplay loop muted>
                        <source src="{% static 'img/van2.mp4' %}" type="video/mp4">
                    </video>
                </div>
                {% else %}
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;"></div>
                    <h5>Order Placed</h5>
                </div>

                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;"></div>
                    <h5>Shipped</h5>
                </div>

                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;"></div>
                    <h5>Out of Delivery</h5>
                </div>
                <div class="track_line" style="width: 2px;height: 100px;background-color: #b0b8c1;margin-left: 9px;">
                </div>

            
                <div class="track-step">
                    <div class="track_dot"
                        style=" width: 20px;height: 20px;background-color: #b0b8c1;border-radius: 50%;">
                    </div>
                    <h5>Delivered</h5>
                </div>
                {% endif %}
            </div><br><br>      
            <div class="d-flex justify-content-center ">
                {% if order_items.status == 'Order Placed' and not order_items.request_cancel %}
                <a href="#" id="cancelOrderBtn" class="btn btn-outline-warning">Cancel</a>
                {% elif order_items.status == 'Delivered' %}
                <a href="{% url 'request_return_product' order_items.id %}" class="btn btn-outline-secondary">Return</a>
                {% elif order_items.status == 'Delivered' or order_items.request_return == True %}
                <button type="button" class="btn btn-primary" disabled>Return Requested</button>
                {% elif order_items.status == 'Shipped' %}
                <button type="button" class="btn btn-primary" disabled>You cannot Cancel after Shipped</button>
                {% elif order_items.status == 'Cancelled' %}
                    <h3>Your Order has been Cancelled.</h3>
                {% elif order_items.request_cancel == True %}
                <button type="button" class="btn btn-primary" disabled>Cancel Requested</button>
                {% endif %}

            </div>
            <br><br>
        </div>

    </div>
    
</div>

<!-- Bootstrap Modal Markup -->
<div class="modal fade" id="cancelOrderModal" tabindex="-1" role="dialog" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelOrderModalLabel">Do you really need to cancel this order?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Confirm to cancel the order.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="confirmCancelOrder">Confirm</button>
        </div>
      </div>
    </div>
  </div>
  

<script>
    // Get the current time
    var currentTime = new Date();

    // Format the time (optional)
    var hours = currentTime.getHours();
    var minutes = currentTime.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0' + minutes : minutes;
    var formattedTime = hours + ':' + minutes + ' ' + ampm;

    // Update the content of the span element with the current time
    document.getElementById('current-time').textContent = formattedTime;
</script>


<script>
    $(document).ready(function() {
        $('#cancelOrderBtn').click(function(e) {
            e.preventDefault(); // Prevent the default action
            Swal.fire({
                title: 'Do you really need to cancel this order?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, cancel it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "{% url 'request_cancel_order' order_items.pk %}"; // Redirect to the cancel order URL
                }
            });
        });
    });
    </script>
    
{% endblock content %}
